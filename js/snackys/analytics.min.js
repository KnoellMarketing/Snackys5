window.dataLayer=window.dataLayer||[];var _paq=window._paq||[];!function(){"use strict";$.snackyAnalytics||($.snackyAnalytics={});var e=function(){};e.prototype={data:{tagmanager:!1,matomoUrl:!1,matomoSiteId:1,galleryPreviews:4,viewtracked:!1},load:function(){"undefined"!=typeof gtagId&&(this.tagmanager=gtagId,this.addTagManager()),"undefined"!=typeof matomoUrl&&(this.matomoUrl=matomoUrl,this.matomoSiteId=matomoSiteId,this.addMatomo()),this.addListener()},addMatomo:function(){_paq.push(["disableCookies"]),_paq.push(["enableLinkTracking"]),_paq.push(["setTrackerUrl",this.matomoUrl+"matomo.php"]),_paq.push(["setSiteId",this.matomoSiteId]),$.ajax({url:this.matomoUrl+"matomo.js",dataType:"script",async:!0})},matomoPageView:function(){this.matomoUrl&&_paq.push(["trackPageView"])},addTagManager:function(e,t,c,a,r){window.dataLayer.push({"gtm.start":(new Date).getTime(),event:"gtm.js"});$.ajax({url:"https://www.googletagmanager.com/gtm.js?id="+this.tagmanager+"&l=dataLayer",dataType:"script",async:!0})},getElementAttrs:function(e){for(var t=new Array,c=0;c<e.attributes.length;c++)t.push({name:e.attributes[c].name,value:e.attributes[c].value});return t},addListener:function(){for(var e,t=document.querySelectorAll("[data-track-event]"),c=0;c<t.length;c++)"start"==(e=t[c].getAttribute("data-track-type"))?this.callEvent(t[c]):0!=e&&t[c].addEventListener(e,$.snackyAnalytics.callEventByListener);this.matomoPageView()},callEventByListener:function(e){$.snackyAnalytics.callEvent(this)},callEvent:function(e){try{var t,c,a=this.getElementAttrs(e),r=new Object,o=!1;for(t in a)if("data-track-event"==a[t].name)o=a[t].value;else if("data-track-p-"==a[t].name.substr(0,13)){if("["==(c=a[t].value).substr(0,1))for(var m in c=JSON.parse(c))for(var i in c[m])"selectorval:"==c[m][i].substr(0,12)?c[m][i]=document.querySelector(c[m][i].substr(12)).value:"selectorhtml:"==c[m][i].substr(0,13)&&(c[m][i]=document.querySelector(c[m][i].substr(13)).innerHTML);r[a[t].name.substr(13)]=c}if($.snackyAnalytics.tagmanager){var s=new Object;switch(o){case"view_item_list":s.ecommerce=new Object,s.ecommerce.currencyCode=r.currency,s.ecommerce.impressions=r.items;break;case"view_item":s.ecommerce=new Object,s.ecommerce.detail=new Object,s.ecommerce.detail.products=r.items;break;case"add_to_cart":s.ecommerce=new Object,s.event="addToCart",s.ecommerce.currencyCode=r.currency,s.ecommerce.add=new Object,s.ecommerce.add.products=r.items;break;case"remove_from_cart":s.ecommerce=new Object,s.event="removeFromCart",s.ecommerce.currencyCode=r.currency,s.ecommerce.remove=new Object,s.ecommerce.remove.products=r.items;break;case"begin_checkout":s.ecommerce=new Object,s.event="checkout",s.ecommerce.checkout=new Object,s.ecommerce.checkout.actionField=new Object,s.ecommerce.checkout.actionField.step=1,s.ecommerce.checkout.products=r.items;break;case"checkout_progress":s.ecommerce=new Object,s.event="checkout",s.ecommerce.checkout=new Object,s.ecommerce.checkout.actionField=new Object,s.ecommerce.checkout.actionField.step=parseInt(r.checkout_step)+1,s.ecommerce.checkout.products=r.items;break;case"purchase":s.ecommerce=new Object,s.ecommerce.purchase=new Object,s.ecommerce.purchase.products=r.items,s.ecommerce.purchase.actionField=new Object,s.ecommerce.purchase.actionField.id=r.transaction_id,s.ecommerce.purchase.actionField.tax=r.tax,s.ecommerce.purchase.actionField.shipping=r.shipping,s.ecommerce.purchase.actionField.revenue=r.value,r.coupon&&(s.ecommerce.purchase.actionField.coupon=r.coupon);break;default:(s=r).event=o}window.dataLayer.push(s)}if($.snackyAnalytics.matomoUrl)if("view_item_list"==o)!0!==this.viewtracked&&(_paq.push(["setEcommerceView",!1,!1,r.items[0].category]),this.viewtracked=!0);else if("view_item"==o)_paq.push(["setEcommerceView",r.items[0].id,r.items[0].name,r.items[0].category,r.items[0].price]),this.viewtracked=!0;else if("add_to_cart"==o);else if("remove_from_cart"==o);else if("begin_checkout"==o||"checkout_progress"==o){for(m=0;m<r.items.length;m++)_paq.push(["addEcommerceItem",r.items[m].id,r.items[m].name,[],r.items[m].price,r.items[m].quantity]);_paq.push(["trackEcommerceCartUpdate",r.value]),this.viewtracked=!0}else if("purchase"==o){for(m=0;m<r.items.length;m++)_paq.push(["addEcommerceItem",r.items[m].id,r.items[m].name,[],r.items[m].price,r.items[m].quantity]);_paq.push(["trackEcommerceOrder",r.transaction_id,r.total,r.value,r.tax,r.shipping]),this.viewtracked=!0}else console.log("matomo unknown event: "+o)}catch(e){console.log(e)}}},$.snackyAnalytics=new e,$.snackyAnalytics.load()}(jQuery);